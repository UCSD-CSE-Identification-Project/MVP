<script language="JavaScript" type="text/javascript" src="/js/jquery-1.2.6.min.js"></script>
<script language="JavaScript" type="text/javascript" src="/js/jquery-ui-personalized-1.5.2.packed.js"></script>
<script language="JavaScript" type="text/javascript" src="/js/sprinkle.js"></script>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Arial;
    }

    /* The grid: Four equal columns that floats next to each other */
    .column {
      float: left;
      width: 25%;
      padding: 10px;
    }

    /* Style the images inside the grid */
    .column img {
      opacity: 0.8;
      cursor: pointer;
    }

    .column img:hover {
      opacity: 1;
    }

    /* Clear floats after the columns */
    .row:after {
      content: "";
      display: table;
      clear: both;
    }

    /* The expanding image container */
    .container {
      position: relative;
      display: none;
    }

    /* Expanding image text */
    #imgtext {
      position: absolute;
      bottom: 15px;
      left: 15px;
      color: white;
      font-size: 20px;
    }

    /* Closable button inside the expanded image */
    .closebtn {
      position: absolute;
      top: 10px;
      right: 15px;
      color: white;
      font-size: 35px;
      cursor: pointer;
    }
  </style>
</head>

<div class="title">
  <h2 style="color: white">Match Images</h2>
  <button mat-raised-button (click)="openDialog()">Guide for this Page</button>
  <button *ngIf="matchesFinished" mat-raised-button class="logoutButton" (click)="logout()">Save & Logout</button>
</div>

<br>
<br>
<br>
<br>
<br>
<br>

<div style="padding: 2%" *ngIf="!matchesFinished">
  <h2>Generating Current Term Matches for Previous Term</h2>
  <mat-spinner></mat-spinner>
  <p> If you would like to continue without having found match for current image: please click Continue </p>
  <br />
  <button mat-raised-button type="submit" (click)="chooseToShowAll=true;populateImagesWithoutMatch();">Continue</button>
</div>

<div class="col-sm-6" *ngIf="matchesFinished; else pgrss">
  <h3>{{prevTermName}} Term Images: Question {{this.termMatching.imageIndex + 1}} out of {{this.termMatching.imageKeysSorted.length}}</h3>

  <div>
    <!-- The Term 1 Images-->
    <img src="{{(matchBar.keyImgUrl| async)?.data().downloadURL}}" width="600px" style="border:5px solid red"> <br />
  </div>

  <br />
  <!-- The image the user chooses that matches the term 1 picture -->
  <h4>Image You Chose:</h4>
  <!-- (imageInput[imageInputIndex]| async)?.data().downloadURL
  (matchBar.selectedURL | async)
  The default is the first image in the highMatches-->
  <img src="{{(matchBar.selectedURL| async)?.data().downloadURL}}" width="600px" id="selectedImg" style="border:5px solid greenyellow"><br />
  <br />
</div>

<ng-template  #pgrss>
  Auto completing matches for you <br>
  Finished matches for Images: {{ termMatching.imageIndex }}
</ng-template>

<div class="col-sm-6 fill-height" *ngIf="matchesFinished">
  <button *ngIf="logoutEnabled" mat-raised-button class="logoutButton" (click)="logout()">Save and Logout</button>
  <h3>Possible matches from term {{currTermName}}</h3>

  <div style="display: inline-flex">
    <h4>Image to Match:</h4>
    <button mat-raised-button type="submit" [disabled]="imagesFinished" (click)="nextImage()" class="activeButton"> Confirm and Next</button>
    <button mat-raised-button type="submit" *ngIf="imagesFinished" class="finishButton" (click)="showSummary()">Show Summary</button>
    <button mat-raised-button type="submit" *ngIf="imagesFinished" class="finishButton" routerLink="../navigator/match">Finish</button>
  </div>

  <!-- If showMatchesHigh is true, show all the img in highMatches  lstSearchResults|async as resultList -->
  <ng-container *ngIf="matchesFinished && matchBar.matchUrl.length > 0">
    <cdk-virtual-scroll-viewport itemSize="50" minBufferPx="200000" maxBufferPx="400000" *ngIf="!termMatching.termFinishedMatching" class="example-viewport">
      <div *cdkVirtualFor="let url of matchBar.matchUrl; let i = index;" class="example-item">
        <div *ngIf="( url | async ) as potentialMatch; else loading">
          <img src="{{potentialMatch.data().downloadURL}}" [ngStyle]="matchBar.matchBorderStyle[i]" width="500px" (click) = "imgClick(i)"/>
        </div>
        <ng-template #loading>
          Loading image...
        </ng-template>
      </div>
    </cdk-virtual-scroll-viewport>
  </ng-container>

</div>
<div *ngIf="getSummary && prevTermURLs.length > 0">
  <cdk-virtual-scroll-viewport itemSize="50" minBufferPx="200000" maxBufferPx="400000" class="example-viewport">
    <div *cdkVirtualFor="let url of prevTermURLs; let i = index;" class="example-item">
      <img src="{{(url | async)?.data().downloadURL}}" width="500px" />
      <img src="{{(currTermURLs[i] | async)?.data().downloadURL}}" width="500px" />
      <!--<img src="{{(currTermURLs[i] | async)?.data().downloadURL}}" width="500px" />-->
    </div>
  </cdk-virtual-scroll-viewport>
</div>

<!--<h2>matchesFinished: {{matchesFinished}}</h2>-->

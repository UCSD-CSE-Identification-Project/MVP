<div class="title">
  <h2 style="color: white">Upload clicker questions & images for previous and current terms</h2>
</div>

<div>
  <button mat-raised-button class="logoutButton" (click)="logout()">Save & Logout</button>
</div>

<div class="container">
  <div class="previous">
    <mat-card class="termCard">
      <h2>Previous Term</h2>
      <mat-checkbox [checked]="usePreexistTerm" (change)="usePreexistTerm = !usePreexistTerm">Use a preexisting term</mat-checkbox>
      <div *ngIf="!usePreexistTerm">
        <h5 style="margin-bottom: 3vh">Input term name: <input [(ngModel)]="prevTerm" type="text" (keyup)="checkPrevTermName()" placeholder="E.g. CSE100FA2018"></h5>
      </div>

      <div *ngIf="usePreexistTerm">
        <h5 style="display: inline-block;">Select a term you want to use: </h5>
        <br>
        <form style="display: inline-block;">
          <select name="weeks" [(ngModel)]="prevTerm" >
            <option *ngFor="let optionTerm of prevTermsCreated" value="{{optionTerm}}">{{optionTerm}}</option>
          </select>
        </form>
      </div>


      <div *ngIf="prevTerm != ''&& prevTerm!=currTerm && !usePreexistTerm && !samePrevTermName">
        <div class="chooseFile">
          <h4>Select folders: </h4>
          <input type="file" id="prevFinal" (change)="tempStore($event,0,0)" webkitdirectory directory multiple style="display:none"/>
          <label for="prevFinal" class="btn btn-primary" style="margin-right:5px; display: inline-block">Select final exam folder</label>
          <div *ngIf="prevTermZip !== null" style="display: inline-block"><p>Final folder saved ({{totalFilesPrev}} files)</p></div>

          <br>
          <br>

          <input type="file" id="prevClicker" (change)="tempStore($event,0,1)" webkitdirectory directory multiple style="display:none"/>
          <label for="prevClicker" class="btn btn-primary" style="margin-right:5px; display: inline-block">Select clicker folder</label>
          <div *ngIf="prevTermC !== null" style="display: inline-block"><p>Clicker folder saved ({{totalFilesPrevC}} files)</p></div>
        </div>
      </div>
    </mat-card>
  </div>

  <div class="current">
    <mat-card class="termCard">
      <h2>Current Term</h2>
      <div>
        <h5 style="margin-bottom: 3vh">Input term name: <input [(ngModel)]="currTerm" type="text" (keyup)="checkCurrTermName()" placeholder="E.g. CSE100FA2018"></h5>
      </div>

      <div *ngIf="currTerm != '' && prevTerm != currTerm && !sameCurrTermName">
        <div class="chooseFile">
          <h4>Select folder: </h4>
          <input type="file" id="currClicker" (change)="tempStore($event, 1)" webkitdirectory directory multiple style="display:none"/>
          <label for="currClicker" class="btn btn-primary" style="margin-right:5px; display: inline-block">Select clicker folder</label>
          <div *ngIf="currTermZip !== null" style="display: inline-block"><p>Clicker folder saved ({{totalFilesCurr}} files)</p></div>
        </div>
      </div>
    </mat-card>
  </div>

  <br />
  <br />
  <br />
  <br />
  <br />

  <div *ngIf="prevTerm == currTerm && prevTerm!=''"><mat-card class="warning">Warning: previous term name cannot be the same as current term name </mat-card></div>
  <div *ngIf="samePrevTermName"><mat-card class="warning">Warning: same name as preexisting term. Please tick checkbox to use the preexisting term. </mat-card></div>
  <div *ngIf="sameCurrTermName"><mat-card class="warning">Warning: current term name cannot be a preexisting term name </mat-card></div>

  <div *ngIf="( prevTermZip != null && prevTermC != null || usePreexistTerm) && currTermZip != null">
    <button mat-raised-button [disabled]="submitButtonClicked"  (click)="onUpload(); submitButtonClicked=true;">Submit</button>
  </div>

  <br />
  <br />
  Previous Term
  <progress-bar class='progress' [progress]='usePreexistTerm ? 100 : allPercentageObservablePrevious | async' [color]="'#488aff'"></progress-bar>
  <br>
  Current Term
  <progress-bar class='progress' [progress]='allPercentageObservableCurrent | async' [color]="'#488aff'"></progress-bar>
  <h4>Percentage of Progress Uploading Images to Online Storage</h4>

  <br />
  <br />
  <div>
    <div class="center">
      <mat-spinner *ngIf="startSpinning && !(numFilePrev===totalFilesPrev+totalFilesPrevC || usePreexistTerm && numFileCurr===totalFilesCurr)">
      </mat-spinner>
      <h4 *ngIf="startSpinning && !(numFilePrev===totalFilesPrev+totalFilesPrevC || usePreexistTerm && numFileCurr===totalFilesCurr)"> Updating image metadata to database </h4>
    </div>
    <div *ngIf="(numFilePrev===totalFilesPrev+totalFilesPrevC || usePreexistTerm && numFileCurr===totalFilesCurr)" style="float: right;">
      <nav>
        <button mat-raised-button class="nextButton" routerLink="/navigator/upload" (click)="generateCsv()">Next</button>
      </nav>
    </div>
  </div>

</div>
